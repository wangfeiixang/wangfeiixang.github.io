function drawFPS() {
  delta = Date.now() - lastCalledTime, fps_count++, delta > 1e3 && (delta = (Date.now() - lastCalledTime) / 1e3,
      lastCalledTime = Date.now(), fps = fps_count, fps_count = 0), ctx.save(),
    ctx.font = "14px Verdana",
    ctx.globalCompositeOperation =
    "source-over", ctx.fillStyle = "white", ctx.fillText("FPS: " + fps, 20, 60), ctx.restore()
}

function drawDecemberCafe() {
  ctx.fillStyle = "white", ctx.fillText("烟花制作", 20, 20)
  ctx.font = "20px Verdana";
}

function updateWindow() {
  w = window, d = document, e = d.documentElement, g = d.getElementsByTagName("body")[0], x = e.clientWidth || w.innerWidth ||
    g.clientWidth, y = e.clientHeight || w.innerHeight || g.clientHeight, width = x < 800 ? 800 : x, height = .7 *
    y, canvas.setAttribute("width", width), canvas.setAttribute("height", height)
}
var canvas = document.getElementById("mycanvas"),
  ctx = canvas.getContext("2d"),
  width = 1600,
  height = 768;
updateWindow();
var backimg = new Image;
backimg.src = "./img/night-trees-stars.jpg";
var lastCalledTime = Date.now(),
  fps = 100,
  delta = 0,
  fps_count = 0,
  time = 0,
  fireworks = [];
setInterval(function () {
  ctx.save(), ctx.globalAlpha = .2, ctx.fillStyle = "black", ctx.fillRect(0, 0, width, height), ctx.drawImage(
      backimg, 0, 0, 1600, 1067, 0, 0, width, height), ctx.restore(), ctx.save(), ctx.globalCompositeOperation =
    "lighter", Math.random() < .1 && fireworks.length < 50 && (fireworks.push(new Firework(ctx, width,
      height)), fireworks[fireworks.length - 1].init({
      x: 50 + Math.random() * (width - 50),
      y: 90 + 100 * Math.random()
    }, {
      h: Math.random(),
      s: 1,
      l: .6 + .3 * Math.random()
    }, 1500 + 1e3 * Math.random(), parseInt(15 + 10 * Math.random()), 4 + 5 * Math.random()), fireworks[
      fireworks.length - 1].size = 4 + 3 * Math.random());
  for (var a = fireworks.length - 1; a >= 0; a--) fireworks[a].time < fireworks[a].duration ? (fireworks[a].update(),
    fireworks[a].render()) : fireworks.splice(a, 1);
  ctx.restore(), drawDecemberCafe(), drawFPS()
}, 33), window.onresize = updateWindow;
